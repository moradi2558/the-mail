{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D-Mail - Ù…ÙˆØ²ÛŒÚ© Ù¾Ù„ÛŒØ±</title>
    <link rel="stylesheet" href="{% static 'css/inbox.css' %}">
    <link rel="stylesheet" href="{% static 'css/loading.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .music-container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .music-content {
            flex: 1;
            display: flex;
            gap: 20px;
            padding: 20px;
            overflow-y: auto;
        }

        .music-sidebar {
            width: 250px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            height: fit-content;
        }

        .music-main {
            flex: 1;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 30px;
            overflow-y: auto;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar-nav-item {
            padding: 15px 20px;
            background: rgba(83, 52, 131, 0.2);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: var(--arcane-white);
            font-family: 'Vazirmatn', sans-serif;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-nav-item:hover,
        .sidebar-nav-item.active {
            background: linear-gradient(135deg, var(--arcane-purple), var(--arcane-pink));
            border-color: var(--arcane-pink);
            transform: translateX(-5px);
        }

        .playlists-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .playlist-card {
            background: rgba(83, 52, 131, 0.2);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .playlist-card:hover {
            background: rgba(142, 36, 170, 0.3);
            border-color: var(--arcane-pink);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(142, 36, 170, 0.3);
        }

        .playlist-card-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .playlist-card-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--arcane-white);
            margin-bottom: 10px;
        }

        .playlist-card-info {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .songs-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .song-item {
            background: rgba(83, 52, 131, 0.2);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .song-item:hover {
            background: rgba(142, 36, 170, 0.3);
            border-color: var(--arcane-pink);
        }

        .song-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--arcane-purple);
        }

        .song-privacy-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .song-icon {
            font-size: 32px;
        }

        .song-info {
            flex: 1;
        }

        .song-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--arcane-white);
            margin-bottom: 5px;
        }

        .song-details {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }

        .song-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 15px;
            background: rgba(83, 52, 131, 0.4);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--arcane-white);
            font-family: 'Vazirmatn', sans-serif;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: var(--arcane-pink);
            border-color: var(--arcane-pink);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--arcane-white);
        }

        .btn-primary {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--arcane-purple), var(--arcane-pink));
            border: none;
            border-radius: 10px;
            color: var(--arcane-white);
            font-family: 'Vazirmatn', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(142, 36, 170, 0.5);
        }

        .upload-area {
            border: 2px dashed var(--glass-border);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: var(--arcane-pink);
            background: rgba(142, 36, 170, 0.1);
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .invitations-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .invitation-item {
            background: rgba(83, 52, 131, 0.2);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .invitation-info {
            flex: 1;
        }

        .invitation-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--arcane-white);
            margin-bottom: 5px;
        }

        .invitation-details {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }

        .invitation-actions {
            display: flex;
            gap: 10px;
        }

        .btn-accept {
            background: rgba(40, 167, 69, 0.3);
            border: 1px solid rgba(40, 167, 69, 0.5);
        }

        .btn-accept:hover {
            background: rgba(40, 167, 69, 0.5);
        }

        .btn-reject {
            background: rgba(220, 53, 69, 0.3);
            border: 1px solid rgba(220, 53, 69, 0.5);
        }

        .btn-reject:hover {
            background: rgba(220, 53, 69, 0.5);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .toast-notification {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, var(--arcane-purple), var(--arcane-pink));
            color: var(--arcane-white);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(142, 36, 170, 0.4);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 14px;
            font-weight: 500;
            min-width: 250px;
            animation: slideInLeft 0.3s ease-out;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .toast-notification.success {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.9), rgba(40, 167, 69, 0.7));
        }

        .toast-notification.error {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.9), rgba(220, 53, 69, 0.7));
        }

        .toast-notification.info {
            background: linear-gradient(135deg, var(--arcane-purple), var(--arcane-pink));
        }

        @keyframes slideInLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutLeft {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(-100%);
                opacity: 0;
            }
        }

        .toast-notification.hide {
            animation: slideOutLeft 0.3s ease-out forwards;
        }

        .toast-icon {
            font-size: 20px;
        }

        .toast-close {
            margin-right: auto;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--arcane-white);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .toast-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .music-content {
                flex-direction: column;
            }

            .music-sidebar {
                width: 100%;
            }

            .playlists-grid {
                grid-template-columns: 1fr;
            }

            .toast-notification {
                left: 10px;
                right: 10px;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="background-container">
        <div class="forest-background"></div>
    </div>

    <div class="music-container">
        <header class="inbox-header">
            <div class="header-left">
                <h1 class="logo">D-Mail</h1>
            </div>
            <div class="header-right">
                <a href="/dashboard/" class="compose-btn" style="text-decoration: none; color: inherit;" onclick="showLoading('Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„');">
                    <span>ğŸ </span>
                    <span>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span>
                </a>
                <div class="user-menu">
                    <button class="user-btn logout-btn" id="logoutBtn" onclick="logout()" title="Ø®Ø±ÙˆØ¬">
                        <span style="font-size: 18px;">â»</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="music-content">
            <aside class="music-sidebar">
                <nav class="sidebar-nav">
                    <a href="#" class="sidebar-nav-item active" data-view="playlists" onclick="switchView('playlists'); return false;">
                        <span>ğŸ“‹</span>
                        <span>Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øªâ€ŒÙ‡Ø§</span>
                    </a>
                    <a href="#" class="sidebar-nav-item" data-view="songs" onclick="switchView('songs'); return false;">
                        <span>ğŸµ</span>
                        <span>Ù…ÙˆØ²ÛŒÚ©â€ŒÙ‡Ø§</span>
                    </a>
                    <a href="#" class="sidebar-nav-item" data-view="upload" onclick="switchView('upload'); return false;">
                        <span>ğŸ“¤</span>
                        <span>Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÙˆØ²ÛŒÚ©</span>
                    </a>
                    <a href="#" class="sidebar-nav-item" data-view="invitations" onclick="switchView('invitations'); return false;">
                        <span>ğŸ“¨</span>
                        <span>Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§</span>
                        <span class="nav-badge" id="invitationsBadge" style="display: none;"></span>
                    </a>
                </nav>
            </aside>

            <main class="music-main">
                <!-- Playlists View -->
                <div id="playlistsView" class="view-section">
                    <div class="section-header">
                        <h2 class="section-title">Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†</h2>
                        <button class="btn-primary" onclick="openCreatePlaylistModal()">+ Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª</button>
                    </div>
                    <div id="playlistsList" class="playlists-grid">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
                        </div>
                    </div>
                </div>

                <!-- Playlist Detail View -->
                <div id="playlistDetailView" class="view-section" style="display: none;">
                    <div class="section-header">
                        <div>
                            <button class="btn-primary" onclick="switchView('playlists')" style="margin-bottom: 10px;">â† Ø¨Ø§Ø²Ú¯Ø´Øª</button>
                            <h2 class="section-title" id="playlistDetailTitle">Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª</h2>
                        </div>
                        <div>
                            <button class="btn-primary" onclick="openAddSongToPlaylistModal()" id="addSongBtn" style="margin-left: 10px;">+ Ø§ÙØ²ÙˆØ¯Ù† Ø¢Ù‡Ù†Ú¯</button>
                            <button class="btn-primary" onclick="openEditPlaylistModal()" id="editPlaylistBtn">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button class="btn-primary" onclick="openInviteModal()" id="inviteBtn" style="margin-right: 10px;">Ø¯Ø¹ÙˆØª Ú©Ø§Ø±Ø¨Ø±</button>
                        </div>
                    </div>
                    <div id="playlistSongsList" class="songs-list">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
                        </div>
                    </div>
                </div>

                <!-- Songs View -->
                <div id="songsView" class="view-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Ù…ÙˆØ²ÛŒÚ©â€ŒÙ‡Ø§</h2>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="text" id="songsSearchInput" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." style="padding: 10px 15px; background: rgba(83, 52, 131, 0.3); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--arcane-white); font-family: 'Vazirmatn', sans-serif; width: 250px;">
                            <select id="songsFilterSelect" style="padding: 10px 15px; background: rgba(83, 52, 131, 0.3); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--arcane-white); font-family: 'Vazirmatn', sans-serif;">
                                <option value="all">Ù‡Ù…Ù‡</option>
                                <option value="my">Ù…ÙˆØ²ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ù…Ù†</option>
                                <option value="public">Ø¹Ù…ÙˆÙ…ÛŒ</option>
                            </select>
                            <button class="btn-primary" id="makePublicBtn" onclick="makeSelectedSongsPublic()" style="display: none; padding: 10px 20px; font-size: 14px;">
                                ğŸ”“ Ø¹Ù…ÙˆÙ…ÛŒ Ú©Ø±Ø¯Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡â€ŒÙ‡Ø§
                            </button>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="selectAllSongs" class="select-checkbox" onchange="toggleSelectAllSongs()">
                        <label for="selectAllSongs" style="color: var(--arcane-white); font-family: 'Vazirmatn', sans-serif; cursor: pointer;">Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡</label>
                        <span id="selectedCount" style="color: rgba(255, 255, 255, 0.7); font-family: 'Vazirmatn', sans-serif; font-size: 14px;"></span>
                    </div>
                    <div id="songsList" class="songs-list">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
                        </div>
                    </div>
                </div>

                <!-- Upload View -->
                <div id="uploadView" class="view-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÙˆØ²ÛŒÚ©</h2>
                    </div>
                    <div class="upload-area" onclick="document.getElementById('fileInput').click();">
                        <div class="upload-icon">ğŸ“¤</div>
                        <h3 style="color: var(--arcane-white); margin-bottom: 10px;">ÙØ§ÛŒÙ„ ÛŒØ§ Ù¾ÙˆØ´Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</h3>
                        <p style="color: rgba(255, 255, 255, 0.6);">Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ú†Ù†Ø¯ ÙØ§ÛŒÙ„ØŒ Ctrl Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯ Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</p>
                        <input type="file" id="fileInput" multiple accept=".mp3,.wav,.flac,.m4a,.ogg,.aac" style="display: none;" webkitdirectory directory>
                        <input type="file" id="singleFileInput" accept=".mp3,.wav,.flac,.m4a,.ogg,.aac" style="display: none;">
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <label style="display: inline-block; padding: 12px 24px; background: rgba(83, 52, 131, 0.3); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--arcane-white); font-family: 'Vazirmatn', sans-serif; cursor: pointer;">
                            <input type="checkbox" id="isPublicCheckbox" style="margin-left: 10px;">
                            Ù…ÙˆØ²ÛŒÚ©â€ŒÙ‡Ø§ Ø±Ø§ Ø¹Ù…ÙˆÙ…ÛŒ Ú©Ù†
                        </label>
                    </div>
                    <div id="uploadProgress" style="margin-top: 20px; display: none;">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p id="uploadProgressText">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯...</p>
                        </div>
                    </div>
                </div>

                <!-- Invitations View -->
                <div id="invitationsView" class="view-section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†</h2>
                    </div>
                    <div id="invitationsList" class="invitations-list">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Create Playlist Modal -->
    <div class="compose-modal" id="createPlaylistModal">
        <div class="compose-modal-content">
            <div class="compose-header">
                <h2>Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª Ø¬Ø¯ÛŒØ¯</h2>
                <button class="close-compose-btn" onclick="closeCreatePlaylistModal()">Ã—</button>
            </div>
            <form id="createPlaylistForm">
                <div class="compose-form-group">
                    <label for="playlistNameInput" style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--arcane-white);">
                        <span style="font-size: 20px;">ğŸ“‹</span>
                        <span>Ù†Ø§Ù… Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª</span>
                    </label>
                    <input
                        type="text"
                        id="playlistNameInput"
                        required
                        placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¢Ù‡Ù†Ú¯â€ŒÙ‡Ø§ÛŒ ØµØ¨Ø­Ú¯Ø§Ù‡ÛŒØŒ ØªÙ…Ø±ÛŒÙ†ØŒ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ‡Ø§..."
                        style="
                            margin-top: 8px;
                            width: 100%;
                            padding: 12px 16px;
                            border-radius: 10px;
                            border: 1px solid var(--glass-border);
                            background: rgba(83, 52, 131, 0.25);
                            color: var(--arcane-white);
                            font-family: 'Vazirmatn', sans-serif;
                            font-size: 14px;
                            outline: none;
                            transition: all 0.2s ease;
                        "
                        onfocus="this.style.borderColor='#8e24aa'; this.style.boxShadow='0 0 0 1px rgba(142,36,170,0.6)';"
                        onblur="this.style.borderColor='var(--glass-border)'; this.style.boxShadow='none';"
                    >
                </div>
                <div class="compose-actions">
                    <button type="button" class="cancel-btn" onclick="closeCreatePlaylistModal()">Ù„ØºÙˆ</button>
                    <button type="submit" class="send-btn">Ø§ÛŒØ¬Ø§Ø¯</button>
                </div>
                <div class="compose-error" id="createPlaylistError" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Edit Playlist Modal -->
    <div class="compose-modal" id="editPlaylistModal">
        <div class="compose-modal-content">
            <div class="compose-header">
                <h2>ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª</h2>
                <button class="close-compose-btn" onclick="closeEditPlaylistModal()">Ã—</button>
            </div>
            <form id="editPlaylistForm">
                <div class="compose-form-group">
                    <label for="editPlaylistNameInput" style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; font-weight: 600; color: var(--arcane-white);">
                        <span>ğŸ“‹</span>
                        <span>Ù†Ø§Ù… Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª</span>
                    </label>
                    <input 
                        type="text" 
                        id="editPlaylistNameInput" 
                        required 
                        placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¢Ù‡Ù†Ú¯â€ŒÙ‡Ø§ÛŒ ØµØ¨Ø­Ú¯Ø§Ù‡ÛŒØŒ ØªÙ…Ø±ÛŒÙ†ØŒ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ‡Ø§..."
                        style="
                            width: 100%;
                            padding: 12px 16px;
                            border-radius: 10px;
                            border: 1px solid var(--glass-border);
                            background: rgba(83, 52, 131, 0.25);
                            color: var(--arcane-white);
                            font-family: 'Vazirmatn', sans-serif;
                            font-size: 14px;
                            outline: none;
                            transition: all 0.2s ease;
                        "
                        onfocus="this.style.borderColor='#8e24aa'; this.style.boxShadow='0 0 0 1px rgba(142,36,170,0.6)';"
                        onblur="this.style.borderColor='var(--glass-border)'; this.style.boxShadow='none';"
                    >
                </div>
                <div class="compose-actions">
                    <button type="button" class="cancel-btn" onclick="closeEditPlaylistModal()">Ù„ØºÙˆ</button>
                    <button type="submit" class="send-btn">Ø°Ø®ÛŒØ±Ù‡</button>
                </div>
                <div class="compose-error" id="editPlaylistError" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Add Song to Playlist Modal -->
    <div class="compose-modal" id="addSongToPlaylistModal">
        <div class="compose-modal-content" style="max-width: 800px; max-height: 90vh;">
            <div class="compose-header">
                <h2>Ø§ÙØ²ÙˆØ¯Ù† Ø¢Ù‡Ù†Ú¯ Ø¨Ù‡ Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª</h2>
                <button class="close-compose-btn" onclick="closeAddSongToPlaylistModal()">Ã—</button>
            </div>
            <div style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <input 
                        type="text" 
                        id="addSongSearchInput" 
                        placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¢Ù‡Ù†Ú¯..." 
                        style="
                            width: 100%;
                            padding: 12px 16px;
                            border-radius: 10px;
                            border: 1px solid var(--glass-border);
                            background: rgba(83, 52, 131, 0.25);
                            color: var(--arcane-white);
                            font-family: 'Vazirmatn', sans-serif;
                            font-size: 14px;
                            outline: none;
                            transition: all 0.2s ease;
                        "
                        onfocus="this.style.borderColor='#8e24aa'; this.style.boxShadow='0 0 0 1px rgba(142,36,170,0.6)';"
                        onblur="this.style.borderColor='var(--glass-border)'; this.style.boxShadow='none';"
                    >
                </div>
                <div id="addSongSongsList" style="max-height: 400px; overflow-y: auto;">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Invite Modal -->
    <div class="compose-modal" id="inviteModal">
        <div class="compose-modal-content">
            <div class="compose-header">
                <h2>Ø¯Ø¹ÙˆØª Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª</h2>
                <button class="close-compose-btn" onclick="closeInviteModal()">Ã—</button>
            </div>
            <form id="inviteForm">
                <div class="compose-form-group">
                    <label for="inviteeEmailInput" style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--arcane-white); margin-bottom: 10px;">
                        <span style="font-size: 20px;">ğŸ“§</span>
                        <span>Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±</span>
                    </label>
                    <div class="receiver-combobox-wrapper" style="position: relative;">
                        <input 
                            type="text" 
                            id="inviteeEmailInput" 
                            class="receiver-input" 
                            required 
                            placeholder="Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."
                            autocomplete="off"
                            style="
                                width: 100%;
                                padding: 12px 45px 12px 16px;
                                border-radius: 10px;
                                border: 1px solid var(--glass-border);
                                background: rgba(83, 52, 131, 0.25);
                                color: var(--arcane-white);
                                font-family: 'Vazirmatn', sans-serif;
                                font-size: 14px;
                                outline: none;
                                transition: all 0.2s ease;
                            "
                            onfocus="this.style.borderColor='#8e24aa'; this.style.boxShadow='0 0 0 1px rgba(142,36,170,0.6)';"
                            onblur="this.style.borderColor='var(--glass-border)'; this.style.boxShadow='none';"
                        >
                        <button 
                            type="button" 
                            class="contacts-icon-btn" 
                            id="inviteContactsIconBtn" 
                            title="Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„ÛŒØ³Øª Ù…Ø®Ø§Ø·Ø¨ÛŒÙ†"
                            style="
                                position: absolute;
                                left: 10px;
                                top: 50%;
                                transform: translateY(-50%);
                                background: transparent;
                                border: none;
                                color: var(--arcane-white);
                                font-size: 18px;
                                cursor: pointer;
                                padding: 5px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                transition: all 0.2s ease;
                            "
                            onmouseover="this.style.color='#8e24aa';"
                            onmouseout="this.style.color='var(--arcane-white)';"
                        >
                            <span>ğŸ‘¥</span>
                        </button>
                        <span class="select-icon" style="position: absolute; left: 40px; top: 50%; transform: translateY(-50%); color: rgba(255, 255, 255, 0.5); font-size: 16px;">ğŸ‘¤</span>
                        <div class="contacts-dropdown" id="inviteContactsDropdown" style="
                            display: none;
                            position: absolute;
                            top: calc(100% + 5px);
                            left: 0;
                            right: 0;
                            background: var(--glass-bg);
                            backdrop-filter: blur(20px);
                            border: 1px solid var(--glass-border);
                            border-radius: 10px;
                            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                            z-index: 1000;
                            max-height: 300px;
                            overflow-y: auto;
                        ">
                            <div class="contacts-dropdown-header" style="
                                padding: 15px;
                                border-bottom: 1px solid var(--glass-border);
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                            ">
                                <span style="color: var(--arcane-white); font-weight: 600; font-family: 'Vazirmatn', sans-serif;">Ù…Ø®Ø§Ø·Ø¨ÛŒÙ†</span>
                                <button 
                                    type="button" 
                                    class="close-contacts-btn" 
                                    id="closeInviteContactsBtn"
                                    style="
                                        background: transparent;
                                        border: none;
                                        color: var(--arcane-white);
                                        font-size: 20px;
                                        cursor: pointer;
                                        padding: 0;
                                        width: 24px;
                                        height: 24px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                    "
                                >Ã—</button>
                            </div>
                            <div class="contacts-dropdown-list" id="inviteContactsDropdownList" style="padding: 10px;">
                                <div class="loading-contacts-inline" style="padding: 20px; text-align: center; color: rgba(255, 255, 255, 0.7);">
                                    <span>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span>
                                </div>
                            </div>
                        </div>
                        <div class="email-suggestions" id="inviteEmailSuggestions" style="
                            display: none;
                            position: absolute;
                            top: calc(100% + 5px);
                            left: 0;
                            right: 0;
                            background: var(--glass-bg);
                            backdrop-filter: blur(20px);
                            border: 1px solid var(--glass-border);
                            border-radius: 10px;
                            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                            z-index: 1000;
                            max-height: 200px;
                            overflow-y: auto;
                        "></div>
                    </div>
                </div>
                <div class="compose-actions">
                    <button type="button" class="cancel-btn" onclick="closeInviteModal()">Ù„ØºÙˆ</button>
                    <button type="submit" class="send-btn">Ø§Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØª</button>
                </div>
                <div class="compose-error" id="inviteError" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer"></div>

    <script src="{% static 'js/loading.js' %}?v=3"></script>
    <script src="{% static 'js/music.js' %}?v=1"></script>
</body>
</html>
